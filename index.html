<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WortTrainer Pro</title>

<style>
:root {
  --bg: #0f172a;
  --card: #1e293b;
  --accent: #3b82f6;
  --text: #f1f5f9;
  --danger: #ef4444;
  --success: #22c55e;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--text);
}

header {
  padding: 20px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
  background: #0b1220;
}

#profileBox{
  text-align:center;
  padding:10px;
  background:#111827;
}

.container {
  padding: 20px;
  max-width: 600px;
  margin: auto;
}

.card {
  background: var(--card);
  padding: 20px;
  border-radius: 16px;
  margin-bottom: 15px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

input, select, button {
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  border-radius: 12px;
  border: none;
  font-size: 16px;
}

input, select {
  background: #334155;
  color: white;
}

button {
  background: var(--accent);
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: 0.2s;
}

button:hover { opacity: 0.9; }

.delete { background: var(--danger); }

.success { color: var(--success); }
.danger { color: var(--danger); }

.nav {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
}

.nav button {
  flex: 1;
  background: #1e293b;
}

.nav button.active { background: var(--accent); }

.hidden { display: none; }
</style>
</head>
<body>

<header>WortTrainer Pro</header>

<div id="profileBox">
  <span id="nicknameDisplay"></span>
  <button onclick="changeNickname()" style="width:auto;padding:6px 10px;margin-left:10px;">–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫</button>
</div>

<div class="container">

<div class="nav">
  <button onclick="switchTab('add')" id="tabAdd" class="active">–î–æ–±–∞–≤–∏—Ç—å</button>
  <button onclick="switchTab('list')" id="tabList">–°–ª–æ–≤–∞</button>
  <button onclick="switchTab('test')" id="tabTest">–¢–µ—Å—Ç</button>
  <button onclick="switchTab('cards')" id="tabCards">–ö–∞—Ä—Ç–æ—á–∫–∏</button>
</div>

<!-- ADD -->
<div id="addSection">
  <div class="card">
    <input id="word" placeholder="–ù–µ–º–µ—Ü–∫–æ–µ —Å–ª–æ–≤–æ">
    <button onclick="startVoiceInput()">üé§ –°–∫–∞–∑–∞—Ç—å —Å–ª–æ–≤–æ</button>
    <input id="translation" placeholder="–ü–µ—Ä–µ–≤–æ–¥ (–∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)">
    <input id="topic" placeholder="–¢–µ–º–∞ (–º–æ–∂–Ω–æ —Å–≤–æ—é)">
    <button onclick="addWord()">–î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ</button>
  </div>
</div>

<!-- LIST -->
<div id="listSection" class="hidden">
  <select id="filterTopic" onchange="renderList()">
    <option value="">–í—Å–µ —Ç–µ–º—ã</option>
  </select>
</div>

<!-- TEST -->
<div id="testSection" class="hidden">
  <div class="card">
    <div id="testWord" style="font-size:22px;margin-bottom:10px;"></div>
    <input id="answerInput" placeholder="–í–∞—à –ø–µ—Ä–µ–≤–æ–¥">
    <button onclick="checkAnswer()">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
    <div id="feedback" style="margin-top:10px;"></div>
    <div style="margin-top:10px;">
      ‚úÖ <span id="correct">0</span> |
      ‚ùå <span id="wrong">0</span>
    </div>
  </div>
</div>

<!-- CARDS -->
<div id="cardsSection" class="hidden">
  <div class="card">
    <div id="cardWord" style="font-size:22px;margin-bottom:10px;"></div>
    <button onclick="flipCard()">–ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å</button>
    <button onclick="nextCard()">–°–ª–µ–¥—É—é—â–∞—è</button>
  </div>
</div>

</div>

<script>
let words = JSON.parse(localStorage.getItem("words")) || [];
let currentIndex = 0;
let correct = 0;
let wrong = 0;

// ===== –ü–†–û–§–ò–õ–¨ =====
let nickname = localStorage.getItem("nickname");
if(!nickname){
  nickname = prompt("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫:");
  if(nickname) localStorage.setItem("nickname", nickname);
}
document.getElementById("nicknameDisplay").innerText = "üë§ " + nickname;

function changeNickname(){
  localStorage.removeItem("nickname");
  location.reload();
}

function save(){
  localStorage.setItem("words", JSON.stringify(words));
  updateTopics();
}

function switchTab(tab){
  ["add","list","test","cards"].forEach(t=>{
    document.getElementById(t+"Section").classList.add("hidden");
    document.getElementById("tab"+t.charAt(0).toUpperCase()+t.slice(1)).classList.remove("active");
  });

  document.getElementById(tab+"Section").classList.remove("hidden");
  document.getElementById("tab"+tab.charAt(0).toUpperCase()+tab.slice(1)).classList.add("active");

  if(tab==="list") renderList();
  if(tab==="test") startTest();
  if(tab==="cards") startCards();
}

// ===== –ü–ï–†–ï–í–û–î =====
async function translateWord(word){
  const url="https://translate.googleapis.com/translate_a/single?client=gtx&sl=de&tl=ru&dt=t&q="+encodeURIComponent(word);
  const res=await fetch(url);
  const data=await res.json();
  return data[0][0][0];
}

document.getElementById("word").addEventListener("blur", async ()=>{
  const w=document.getElementById("word").value.trim();
  if(!w) return;
  document.getElementById("translation").value="–ü–µ—Ä–µ–≤–æ–¥...";
  try{
    document.getElementById("translation").value=await translateWord(w);
  }catch{
    document.getElementById("translation").value="";
  }
});

// ===== –ì–û–õ–û–° =====
function startVoiceInput(){
  if(!('webkitSpeechRecognition' in window)){
    alert("–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Chrome –∏–ª–∏ Edge");
    return;
  }

  const recognition = new webkitSpeechRecognition();
  recognition.lang = "de-DE";
  recognition.start();

  recognition.onresult = async function(event){
    const spokenWord = event.results[0][0].transcript;
    document.getElementById("word").value = spokenWord;

    document.getElementById("translation").value="–ü–µ—Ä–µ–≤–æ–¥...";
    try{
      document.getElementById("translation").value=await translateWord(spokenWord);
    }catch{
      document.getElementById("translation").value="";
    }
  };
}

function addWord(){
  const word=document.getElementById("word").value.trim();
  const translation=document.getElementById("translation").value.trim();
  const topic=document.getElementById("topic").value.trim() || "–ë–µ–∑ —Ç–µ–º—ã";

  if(!word||!translation) return alert("–ó–∞–ø–æ–ª–Ω–∏ —Å–ª–æ–≤–æ");

  words.push({word,translation,topic});
  save();

  document.getElementById("word").value="";
  document.getElementById("translation").value="";
  document.getElementById("topic").value="";
}

function updateTopics(){
  const filter=document.getElementById("filterTopic");
  const unique=[...new Set(words.map(w=>w.topic))];
  filter.innerHTML='<option value="">–í—Å–µ —Ç–µ–º—ã</option>';
  unique.forEach(t=>filter.innerHTML+=`<option value="${t}">${t}</option>`);
}

function renderList(){
  const container=document.getElementById("listSection");
  const filter=document.getElementById("filterTopic").value;
  container.innerHTML=document.getElementById("filterTopic").outerHTML;

  words.filter(w=>!filter||w.topic===filter)
  .forEach((w,i)=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <strong>${w.word}</strong><br>
      ${w.translation}<br>
      <small>${w.topic}</small>
      <button class="delete" onclick="deleteWord(${i})">–£–¥–∞–ª–∏—Ç—å</button>
    `;
    container.appendChild(div);
  });
}

function deleteWord(i){
  words.splice(i,1);
  save();
  renderList();
}

// ===== –¢–ï–°–¢ =====
function startTest(){
  if(words.length===0){
    document.getElementById("testWord").innerText="–ù–µ—Ç —Å–ª–æ–≤";
    return;
  }
  currentIndex=0;correct=0;wrong=0;updateStats();nextWord();
}

function nextWord(){
  if(currentIndex>=words.length){
    document.getElementById("testWord").innerText="–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!";
    return;
  }
  document.getElementById("feedback").innerText="";
  document.getElementById("answerInput").value="";
  document.getElementById("testWord").innerText=words[currentIndex].word;
}

function checkAnswer(){
  const user=document.getElementById("answerInput").value.trim().toLowerCase();
  const correctAnswer=words[currentIndex].translation.toLowerCase();

  if(user===correctAnswer){
    correct++;
    document.getElementById("feedback").innerHTML="<span class='success'>–ü—Ä–∞–≤–∏–ª—å–Ω–æ!</span>";
  }else{
    wrong++;
    document.getElementById("feedback").innerHTML="<span class='danger'>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! "+correctAnswer+"</span>";
  }

  currentIndex++;updateStats();setTimeout(nextWord,1200);
}

function updateStats(){
  document.getElementById("correct").innerText=correct;
  document.getElementById("wrong").innerText=wrong;
}

// ===== –ö–ê–†–¢–û–ß–ö–ò =====
let cardIndex=0;
let showFront=true;

function startCards(){
  if(words.length===0){
    document.getElementById("cardWord").innerText="–ù–µ—Ç —Å–ª–æ–≤";
    return;
  }
  cardIndex=0;showFront=true;showCard();
}

function showCard(){
  if(cardIndex>=words.length){
    document.getElementById("cardWord").innerText="–ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å";
    return;
  }
  const w=words[cardIndex];
  document.getElementById("cardWord").innerText=
    showFront?w.word:w.translation;
}

function flipCard(){
  showFront=!showFront;
  showCard();
}

function nextCard(){
  cardIndex++;
  showFront=true;
  showCard();
}

updateTopics();
</script>

</body>
</html>